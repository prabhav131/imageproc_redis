<!DOCTYPE html>
<html lang="en">
<head>
    <title>Image Task</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Image Processor</h1>
    <form action="/api/submit-task" method="post">
        <input type="url" name="imageUrl" placeholder="Enter Image URL" required>
        <button type="submit">Submit</button>
    </form>
    <table>
        <thead>
            <tr>
                <th>Task ID</th>
                <th>Image URL</th>
                <th>Status</th>
                <th>Metadata</th>
            </tr>
        </thead>
        <tbody id="task-list">
            {% for task in tasks %}
            <tr id="task-{{ task['task_id'] }}">
                <td>{{ task['task_id'] }}</td>
                <td>{{ task['image_url'] }}</td>
                <td>{{ task['status'] }}</td>
                <td>{{ task['metadata'] | safe }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        const eventSource = new EventSource('/api/task-status');
        
        eventSource.onmessage = function(event) {
            console.log("Received update:", event.data);
            const taskData = JSON.parse(event.data); // Parse the JSON message

            const taskId = taskData.task_id;
            const taskStatus = taskData.status;
            const taskMetadata = JSON.stringify(taskData.metadata); // Convert metadata to string for display

            // Find the row corresponding to the task ID
            const taskRow = document.getElementById(`task-${taskId}`);
            if (taskRow) {
                // Update the status and metadata columns
                taskRow.cells[2].textContent = taskStatus;
                taskRow.cells[3].textContent = taskMetadata;
            }
        };
    </script>
</body>
</html>
